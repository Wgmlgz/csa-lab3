in_source: |-
  (fn print_byte (n int) ((local_get n) (out 1)))

  (fn print_str (s str)
    ((let i 0)
    (while (- i (. 's len)) (
      (let t (* (+ (. 's ptr) i)))
      (local_get_1 t)
      (out 1)
      (set i (+ i 1))
      ()))))

  (fn nl (print_str "\n"))

  (fn print (s str)
    ((print_str(s))
    (nl)))

  (fn print_n (n int)
    ((let cur 100000000)
    (let base 10)
    (let zero 48)
    (if (= n 0)
      (print_str "0")
      ((while (= 0 (% (/ n cur) base)) (
          (set cur (/ cur base)) ))
        (while cur (
          (print_byte (+ (% (/ n cur) base) zero))
          (set cur (/ cur base)) ))))
    ()))

  (let heap (mem int 50))

  (let len 50)
  (def (arr ints))
  (pset (-> 'arr ptr) heap)
  (pset (-> 'arr len) len)


  (fn get (arr ints) (i int) int* (+ (. 'arr ptr) (* i 8)))

  (fn print_ints (arr ints)
    ((print_str "[")
    (let i 0)
    (while (< i (. 'arr len)) (
      (if i (print_str ", ") ())
      (print_n (* (get arr i)))
      (set i (+ i 1))
      ()
    ))
    (print_str "]\n")))

  (fn fill (arr ints)
    ((let i 0)
    (while (< i (. 'arr len)) (
      (pset (get arr i) (% (* (+ i 666) 666342123) 100))
      (set i (+ i 1))
      ()))))


  (fn sort (arr ints)
    ((let i 0)
    (while (< i (. 'arr len))
      ((let j (+ i 1))
      (while (< j (. 'arr len)) (
        (if (< (* (get arr j)) (* (get arr i)))
          ((let t (* (get arr j)))
          (pset (get arr j) (* (get arr i)))
          (pset (get arr i) t))
        ())
        (set j (+ j 1))
        ()))
      (set i (+ i 1))
      ()))))

  (print_ints arr)
  (fill arr)
  (print_ints arr)
  (sort arr)
  (print_ints arr)
in_stdin: ''
out_log: |
  INFO     root:machine.py:47 
  INFO     root:machine.py:48 Ticks: 1630090
  INFO     root:machine.py:49 Instructions: 296130

  INFO     root:machine.py:50 Cache-hit-rate: 89.88%
out_stdout: |
  ============================================================
  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  [18, 41, 64, 87, 10, 33, 56, 79, 2, 25, 48, 71, 94, 17, 40, 63, 86, 9, 32, 55, 78, 1, 24, 47, 70, 93, 16, 39, 62, 85, 8, 31, 54, 77, 0, 23, 46, 69, 92, 15, 38, 61, 84, 7, 30, 53, 76, 99, 22, 45]
  [0, 1, 2, 7, 8, 9, 10, 15, 16, 17, 18, 22, 23, 24, 25, 30, 31, 32, 33, 38, 39, 40, 41, 45, 46, 47, 48, 53, 54, 55, 56, 61, 62, 63, 64, 69, 70, 71, 76, 77, 78, 79, 84, 85, 86, 87, 92, 93, 94, 99]
out_code: |-
  {
    "instructions": [
      ["load", 1978],
      ["local_set", -8],
      ["load", 50],
      ["local_set", -16],
      ["local_ptr", -32],
      ["local_set", -56],
      ["local_get", -56],
      ["add_cmd", 0],
      ["local_set", -40],
      ["local_get", -8],
      ["local_set", -48],
      ["local_get", -48],
      ["write_by_local", -40],
      ["local_ptr", -32],
      ["local_set", -56],
      ["local_get", -56],
      ["add_cmd", 8],
      ["local_set", -40],
      ["local_get", -16],
      ["local_set", -48],
      ["local_get", -48],
      ["write_by_local", -40],
      ["load", 240],
      ["local_set", -40],
      ["local_get", -32],
      ["local_set", -56],
      ["local_get", -24],
      ["local_set", -48],
      ["shift_stack", -32],
      ["jmp", 2546],
      ["unshift_stack", -32],
      ["load", 312],
      ["local_set", -40],
      ["local_get", -32],
      ["local_set", -56],
      ["local_get", -24],
      ["local_set", -48],
      ["shift_stack", -32],
      ["jmp", 3215],
      ["unshift_stack", -32],
      ["load", 384],
      ["local_set", -40],
      ["local_get", -32],
      ["local_set", -56],
      ["local_get", -24],
      ["local_set", -48],
      ["shift_stack", -32],
      ["jmp", 2546],
      ["unshift_stack", -32],
      ["load", 456],
      ["local_set", -40],
      ["local_get", -32],
      ["local_set", -56],
      ["local_get", -24],
      ["local_set", -48],
      ["shift_stack", -32],
      ["jmp", 3703],
      ["unshift_stack", -32],
      ["load", 528],
      ["local_set", -40],
      ["local_get", -32],
      ["local_set", -56],
      ["local_get", -24],
      ["local_set", -48],
      ["shift_stack", -32],
      ["jmp", 2546],
      ["unshift_stack", -32],
      ["halt"],
      ["local_get", -16],
      ["out", 1],
      ["local_get", -8],
      ["jmp_acc"],
      ["load", 0],
      ["local_set", -32],
      ["local_get", -32],
      ["local_set", -48],
      ["local_ptr", -24],
      ["local_set", -72],
      ["local_get", -72],
      ["add_cmd", 8],
      ["local_set", -64],
      ["local_get", -64],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -56],
      ["local_get", -48],
      ["sub_local", -56],
      ["local_set", -40],
      ["local_get", -40],
      ["jmp_if_false", 944],
      ["local_ptr", -24],
      ["local_set", -73],
      ["local_get", -73],
      ["add_cmd", 0],
      ["local_set", -65],
      ["local_get", -65],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -49],
      ["local_get", -32],
      ["local_set", -57],
      ["local_get", -49],
      ["add_local", -57],
      ["local_set", -41],
      ["local_get", -41],
      ["add_cmd", 0],
      ["deref_1"],
      ["local_set_1", -33],
      ["local_get_1", -33],
      ["out", 1],
      ["local_get", -32],
      ["local_set", -41],
      ["load", 1],
      ["local_set", -49],
      ["local_get", -41],
      ["add_local", -49],
      ["local_set", -32],
      ["jmp", 592],
      ["local_get", -8],
      ["jmp_acc"],
      ["load", 1024],
      ["local_set", -16],
      ["load", 1048],
      ["local_set", -32],
      ["load", 1],
      ["local_set", -24],
      ["shift_stack", -8],
      ["jmp", 576],
      ["unshift_stack", -8],
      ["local_get", -8],
      ["jmp_acc"],
      [10],
      ["load", 1145],
      ["local_set", -32],
      ["local_get", -24],
      ["local_set", -64],
      ["local_get", -16],
      ["local_set", -56],
      ["local_get", -64],
      ["local_set", -48],
      ["local_get", -56],
      ["local_set", -40],
      ["shift_stack", -24],
      ["jmp", 576],
      ["unshift_stack", -24],
      ["load", 1185],
      ["local_set", -32],
      ["shift_stack", -24],
      ["jmp", 960],
      ["unshift_stack", -24],
      ["local_get", -8],
      ["jmp_acc"],
      ["load", 100000000],
      ["local_set", -24],
      ["load", 10],
      ["local_set", -32],
      ["load", 48],
      ["local_set", -40],
      ["local_get", -16],
      ["local_set", -64],
      ["load", 0],
      ["local_set", -72],
      ["local_get", -64],
      ["sub_local", -72],
      ["invert_bool"],
      ["local_set", -56],
      ["local_get", -56],
      ["jmp_if_false", 1417],
      ["load", 1401],
      ["local_set", -56],
      ["load", 1977],
      ["local_set", -72],
      ["load", 1],
      ["local_set", -64],
      ["shift_stack", -48],
      ["jmp", 576],
      ["unshift_stack", -48],
      ["jmp", 1961],
      ["load", 0],
      ["local_set", -72],
      ["local_get", -16],
      ["local_set", -104],
      ["local_get", -24],
      ["local_set", -112],
      ["local_get", -104],
      ["div_local", -112],
      ["local_set", -88],
      ["local_get", -32],
      ["local_set", -96],
      ["local_get", -88],
      ["rem_local", -96],
      ["local_set", -80],
      ["local_get", -72],
      ["sub_local", -80],
      ["invert_bool"],
      ["local_set", -64],
      ["local_get", -64],
      ["jmp_if_false", 1673],
      ["local_get", -24],
      ["local_set", -72],
      ["local_get", -32],
      ["local_set", -80],
      ["local_get", -72],
      ["div_local", -80],
      ["local_set", -24],
      ["local_get", -24],
      ["local_set", -64],
      ["local_get", -64],
      ["local_set", -56],
      ["jmp", 1417],
      ["local_get", -24],
      ["local_set", -56],
      ["local_get", -56],
      ["jmp_if_false", 1961],
      ["load", 1873],
      ["local_set", -56],
      ["local_get", -16],
      ["local_set", -104],
      ["local_get", -24],
      ["local_set", -112],
      ["local_get", -104],
      ["div_local", -112],
      ["local_set", -88],
      ["local_get", -32],
      ["local_set", -96],
      ["local_get", -88],
      ["rem_local", -96],
      ["local_set", -72],
      ["local_get", -40],
      ["local_set", -80],
      ["local_get", -72],
      ["add_local", -80],
      ["local_set", -64],
      ["shift_stack", -48],
      ["jmp", 544],
      ["unshift_stack", -48],
      ["local_get", -24],
      ["local_set", -56],
      ["local_get", -32],
      ["local_set", -64],
      ["local_get", -56],
      ["div_local", -64],
      ["local_set", -24],
      ["local_get", -24],
      ["local_set", -48],
      ["jmp", 1673],
      ["local_get", -8],
      ["jmp_acc"],
      [48],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      [0],
      ["local_ptr", -32],
      ["local_set", -72],
      ["local_get", -72],
      ["add_cmd", 0],
      ["local_set", -64],
      ["local_get", -64],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -48],
      ["local_get", -40],
      ["local_set", -64],
      ["load", 8],
      ["local_set", -72],
      ["local_get", -64],
      ["mul_local", -72],
      ["local_set", -56],
      ["local_get", -48],
      ["add_local", -56],
      ["local_set", -8],
      ["local_get", -16],
      ["jmp_acc"],
      ["load", 2610],
      ["local_set", -40],
      ["load", 3210],
      ["local_set", -56],
      ["load", 1],
      ["local_set", -48],
      ["shift_stack", -32],
      ["jmp", 576],
      ["unshift_stack", -32],
      ["load", 0],
      ["local_set", -32],
      ["local_get", -32],
      ["local_set", -48],
      ["local_ptr", -24],
      ["local_set", -72],
      ["local_get", -72],
      ["add_cmd", 8],
      ["local_set", -64],
      ["local_get", -64],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -56],
      ["local_get", -48],
      ["sub_local", -56],
      ["is_neg"],
      ["local_set", -40],
      ["local_get", -40],
      ["jmp_if_false", 3122],
      ["local_get", -32],
      ["local_set", -40],
      ["local_get", -40],
      ["jmp_if_false", 2882],
      ["load", 2866],
      ["local_set", -40],
      ["load", 3211],
      ["local_set", -56],
      ["load", 2],
      ["local_set", -48],
      ["shift_stack", -32],
      ["jmp", 576],
      ["unshift_stack", -32],
      ["jmp", 2882],
      ["load", 3050],
      ["local_set", -40],
      ["load", 2978],
      ["local_set", -72],
      ["local_get", -24],
      ["local_set", -88],
      ["local_get", -16],
      ["local_set", -80],
      ["local_get", -32],
      ["local_set", -96],
      ["shift_stack", -56],
      ["jmp", 2378],
      ["unshift_stack", -56],
      ["local_get", -64],
      ["local_set", -56],
      ["local_get", -56],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -48],
      ["shift_stack", -32],
      ["jmp", 1209],
      ["unshift_stack", -32],
      ["local_get", -32],
      ["local_set", -40],
      ["load", 1],
      ["local_set", -48],
      ["local_get", -40],
      ["add_local", -48],
      ["local_set", -32],
      ["jmp", 2634],
      ["load", 3186],
      ["local_set", -40],
      ["load", 3213],
      ["local_set", -56],
      ["load", 2],
      ["local_set", -48],
      ["shift_stack", -32],
      ["jmp", 576],
      ["unshift_stack", -32],
      ["local_get", -8],
      ["jmp_acc"],
      [91],
      [44],
      [32],
      [93],
      [10],
      ["load", 0],
      ["local_set", -32],
      ["local_get", -32],
      ["local_set", -48],
      ["local_ptr", -24],
      ["local_set", -72],
      ["local_get", -72],
      ["add_cmd", 8],
      ["local_set", -64],
      ["local_get", -64],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -56],
      ["local_get", -48],
      ["sub_local", -56],
      ["is_neg"],
      ["local_set", -40],
      ["local_get", -40],
      ["jmp_if_false", 3687],
      ["load", 3447],
      ["local_set", -64],
      ["local_get", -24],
      ["local_set", -80],
      ["local_get", -16],
      ["local_set", -72],
      ["local_get", -32],
      ["local_set", -88],
      ["shift_stack", -48],
      ["jmp", 2378],
      ["unshift_stack", -48],
      ["local_get", -56],
      ["local_set", -40],
      ["local_get", -32],
      ["local_set", -88],
      ["load", 666],
      ["local_set", -96],
      ["local_get", -88],
      ["add_local", -96],
      ["local_set", -72],
      ["load", 666342123],
      ["local_set", -80],
      ["local_get", -72],
      ["mul_local", -80],
      ["local_set", -56],
      ["load", 100],
      ["local_set", -64],
      ["local_get", -56],
      ["rem_local", -64],
      ["local_set", -48],
      ["local_get", -48],
      ["write_by_local", -40],
      ["local_get", -32],
      ["local_set", -40],
      ["load", 1],
      ["local_set", -48],
      ["local_get", -40],
      ["add_local", -48],
      ["local_set", -32],
      ["jmp", 3231],
      ["local_get", -8],
      ["jmp_acc"],
      ["load", 0],
      ["local_set", -32],
      ["local_get", -32],
      ["local_set", -48],
      ["local_ptr", -24],
      ["local_set", -72],
      ["local_get", -72],
      ["add_cmd", 8],
      ["local_set", -64],
      ["local_get", -64],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -56],
      ["local_get", -48],
      ["sub_local", -56],
      ["is_neg"],
      ["local_set", -40],
      ["local_get", -40],
      ["jmp_if_false", 5031],
      ["local_get", -32],
      ["local_set", -48],
      ["load", 1],
      ["local_set", -56],
      ["local_get", -48],
      ["add_local", -56],
      ["local_set", -40],
      ["local_get", -40],
      ["local_set", -56],
      ["local_ptr", -24],
      ["local_set", -80],
      ["local_get", -80],
      ["add_cmd", 8],
      ["local_set", -72],
      ["local_get", -72],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -64],
      ["local_get", -56],
      ["sub_local", -64],
      ["is_neg"],
      ["local_set", -48],
      ["local_get", -48],
      ["jmp_if_false", 4967],
      ["load", 4127],
      ["local_set", -88],
      ["local_get", -24],
      ["local_set", -104],
      ["local_get", -16],
      ["local_set", -96],
      ["local_get", -40],
      ["local_set", -112],
      ["shift_stack", -72],
      ["jmp", 2378],
      ["unshift_stack", -72],
      ["local_get", -80],
      ["local_set", -72],
      ["local_get", -72],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -56],
      ["load", 4263],
      ["local_set", -88],
      ["local_get", -24],
      ["local_set", -104],
      ["local_get", -16],
      ["local_set", -96],
      ["local_get", -32],
      ["local_set", -112],
      ["shift_stack", -72],
      ["jmp", 2378],
      ["unshift_stack", -72],
      ["local_get", -80],
      ["local_set", -72],
      ["local_get", -72],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -64],
      ["local_get", -56],
      ["sub_local", -64],
      ["is_neg"],
      ["local_set", -48],
      ["local_get", -48],
      ["jmp_if_false", 4903],
      ["load", 4447],
      ["local_set", -72],
      ["local_get", -24],
      ["local_set", -88],
      ["local_get", -16],
      ["local_set", -80],
      ["local_get", -40],
      ["local_set", -96],
      ["shift_stack", -56],
      ["jmp", 2378],
      ["unshift_stack", -56],
      ["local_get", -64],
      ["local_set", -56],
      ["local_get", -56],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -48],
      ["load", 4583],
      ["local_set", -80],
      ["local_get", -24],
      ["local_set", -96],
      ["local_get", -16],
      ["local_set", -88],
      ["local_get", -40],
      ["local_set", -104],
      ["shift_stack", -64],
      ["jmp", 2378],
      ["unshift_stack", -64],
      ["local_get", -72],
      ["local_set", -56],
      ["load", 4687],
      ["local_set", -88],
      ["local_get", -24],
      ["local_set", -104],
      ["local_get", -16],
      ["local_set", -96],
      ["local_get", -32],
      ["local_set", -112],
      ["shift_stack", -72],
      ["jmp", 2378],
      ["unshift_stack", -72],
      ["local_get", -80],
      ["local_set", -72],
      ["local_get", -72],
      ["add_cmd", 0],
      ["deref"],
      ["local_set", -64],
      ["local_get", -64],
      ["write_by_local", -56],
      ["load", 4839],
      ["local_set", -80],
      ["local_get", -24],
      ["local_set", -96],
      ["local_get", -16],
      ["local_set", -88],
      ["local_get", -32],
      ["local_set", -104],
      ["shift_stack", -64],
      ["jmp", 2378],
      ["unshift_stack", -64],
      ["local_get", -72],
      ["local_set", -56],
      ["local_get", -48],
      ["local_set", -64],
      ["local_get", -64],
      ["write_by_local", -56],
      ["jmp", 4903],
      ["local_get", -40],
      ["local_set", -48],
      ["load", 1],
      ["local_set", -56],
      ["local_get", -48],
      ["add_local", -56],
      ["local_set", -40],
      ["jmp", 3911],
      ["local_get", -32],
      ["local_set", -48],
      ["load", 1],
      ["local_set", -56],
      ["local_get", -48],
      ["add_local", -56],
      ["local_set", -32],
      ["jmp", 3719],
      ["local_get", -8],
      ["jmp_acc"]
    ]
  }
